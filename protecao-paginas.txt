Objetivo: deixar as páginas do app visíveis apenas para quem estiver "logado" e identificar se há alguém logado.

Premissas do projeto atual:
- O login é baseado na coleção Firestore "alunos" (campo user + password), e usamos Auth Anônima do Firebase apenas para habilitar as regras read/write.
- Não há autenticação de usuário do Firebase (email/senha, etc.) para a sessão do app. A sessão é gravada no localStorage como um objeto simples.

Recomendação 1: Sessão via localStorage (mais simples)
1) Ao efetuar login (index.html), salve os dados essenciais no localStorage, por exemplo:
   localStorage.setItem("bn.currentUser", JSON.stringify({ user, firstName, lastName, saldo, classe, idAluno }))
2) Nas páginas protegidas (adicionarAluno.html, dev.html, dashboard.html), no início do script:
   - Ler localStorage.getItem("bn.currentUser");
   - Se inexistente/nulo ou sem campo "user", redirecionar para index.html.
3) Ao clicar em "Sair", remova a sessão:
   localStorage.removeItem("bn.currentUser")

Prós: simples, funciona no GitHub Pages sem backend. Contras: não é criptografado; o usuário pode manipular o localStorage (apenas segurança fraca no cliente).

Recomendação 2: Regras do Firestore com Auth (reforço)
- Mantenha o Auth Anônimo ATIVADO para permitir que as regras usem request.auth != null.
- Regras mínimas:
  rules_version = '2';
  service cloud.firestore {
    match /databases/bancodaneondb/documents {
      match /alunos/{docId} {
        allow read, write: if request.auth != null;
      }
      match /debug/{docId} {
        allow read, write: if request.auth != null;
      }
    }
  }

Observação: isso não impede que alguém autenticado anonimamente leia sua base se conhecer o projectId. Se precisar de controle real por usuário, use autenticação Firebase (email/senha ou outro provedor) e vincule o doc do aluno ao uid.

Identificação de usuário logado
- Padrão do projeto: considerar "logado" se existir bn.currentUser no localStorage com um objeto válido.
- Para exibir quem está logado:
  const sess = JSON.parse(localStorage.getItem("bn.currentUser")||"null");
  console.log("Usuário logado:", sess?.user, "classe:", sess?.classe);

Fortalecimento opcional (se necessário):
- Usar Firebase Auth de verdade (ex.: email/senha), e trocar as regras para permitir acesso apenas ao próprio documento do usuário:
  match /alunos/{docId} {
    allow read, write: if request.auth != null && request.auth.uid == resource.data.uid;
  }
- Armazenar uid no documento do aluno no momento da criação.

Para o escopo atual (GitHub Pages, sem backend), use a combinação:
- Sessão via localStorage + redirecionamento de proteção nas páginas.
- Auth anônima ativada + regras mínimas acima.


