<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Drive • Banco da Neon</title>
  <link rel="icon" href="assets/logotipo.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles/drive.css" />
</head>
<body>
  <div id="header-container"></div>
  
  <div class="drive-container">
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button id="backBtn" class="btn-icon" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m15 18-6-6 6-6"/>
          </svg>
        </button>
        <div class="breadcrumb" id="breadcrumb">
          <span class="breadcrumb-item active">Root</span>
        </div>
      </div>
      
      <div class="toolbar-center">
        <div class="search-box">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" placeholder="Buscar no Firebase..." id="searchInput" />
        </div>
      </div>
      
      <div class="toolbar-right">
        <button id="refreshBtn" class="btn-icon" title="Atualizar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            <path d="M3 21v-5h5"/>
          </svg>
        </button>
        
        <div class="view-toggle">
          <button id="cardViewBtn" class="btn-icon active" title="Visualização em Cards">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
            </svg>
          </button>
          <button id="listViewBtn" class="btn-icon" title="Visualização em Lista">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"/>
              <line x1="8" y1="12" x2="21" y2="12"/>
              <line x1="8" y1="18" x2="21" y2="18"/>
              <line x1="3" y1="6" x2="3.01" y2="6"/>
              <line x1="3" y1="12" x2="3.01" y2="12"/>
              <line x1="3" y1="18" x2="3.01" y2="18"/>
            </svg>
          </button>
        </div>
        
        <button id="createBtn" class="btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14"/>
            <path d="M5 12h14"/>
          </svg>
          Criar
        </button>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Left Panel: Content Explorer -->
      <div class="content-panel">
        <div class="content-header">
          <h2 id="contentTitle">Firebase Drive</h2>
          <div class="content-info" id="contentInfo">
            Selecione uma fonte de dados para começar
          </div>
        </div>
        
        <div class="content-grid" id="contentGrid">
          <!-- Content will be populated here -->
        </div>
        
        <div class="loading-state" id="loadingState" style="display: none;">
          <div class="spinner"></div>
          <p>Carregando...</p>
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
          <h3>Nenhum item encontrado</h3>
          <p>Esta localização está vazia ou você não tem permissão para visualizar o conteúdo.</p>
        </div>
      </div>
      
      <!-- Right Panel: Properties/Details -->
      <div class="details-panel" id="detailsPanel">
        <div class="details-header">
          <h3>Propriedades</h3>
          <button id="closeDetailsBtn" class="btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        
        <div class="details-content" id="detailsContent">
          <div class="no-selection">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            <p>Selecione um item para ver suas propriedades</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  
  <!-- Create Modal -->
  <div id="createModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Criar Novo Item</h3>
        <button class="modal-close" data-modal="createModal">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Tipo</label>
          <select id="createType">
            <option value="collection">Coleção</option>
            <option value="document">Documento</option>
          </select>
        </div>
        <div class="form-group">
          <label for="createName">Nome/ID</label>
          <input type="text" id="createName" placeholder="Digite o nome ou ID..." />
          <small class="form-help">Para documentos, deixe vazio para ID automático</small>
        </div>
        <div class="form-group" id="documentFieldsGroup" style="display: none;">
          <label>Campos do Documento</label>
          <div id="documentFields">
            <div class="field-row">
              <input type="text" placeholder="Nome do campo" class="field-name" />
              <select class="field-type">
                <option value="string">String</option>
                <option value="number">Number</option>
                <option value="boolean">Boolean</option>
                <option value="timestamp">Timestamp</option>
                <option value="array">Array</option>
                <option value="object">Object</option>
              </select>
              <input type="text" placeholder="Valor" class="field-value" />
              <button type="button" class="btn-remove-field">×</button>
            </div>
          </div>
          <button type="button" id="addFieldBtn" class="btn-secondary">+ Adicionar Campo</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-modal="createModal">Cancelar</button>
        <button class="btn-primary" id="confirmCreateBtn">Criar</button>
      </div>
    </div>
  </div>
  
  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Editar Documento</h3>
        <button class="modal-close" data-modal="editModal">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div id="editFields">
          <!-- Fields will be populated here -->
        </div>
        <button type="button" id="addEditFieldBtn" class="btn-secondary">+ Adicionar Campo</button>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-modal="editModal">Cancelar</button>
        <button class="btn-primary" id="confirmEditBtn">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirmar Exclusão</h3>
        <button class="modal-close" data-modal="deleteModal">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="delete-warning">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
            <path d="M12 9v4"/>
            <path d="m12 17 .01 0"/>
          </svg>
          <h4>Tem certeza?</h4>
          <p id="deleteMessage">Esta ação não pode ser desfeita.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-modal="deleteModal">Cancelar</button>
        <button class="btn-danger" id="confirmDeleteBtn">Excluir</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      fetch('components/header.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById('header-container').innerHTML = html;
          const script = document.createElement('script');
          script.src = 'components/header-menu.js';
          document.body.appendChild(script);
        });
    });
  </script>
  
  <!-- Load Firebase Manager first, then Drive -->
  <script type="module">
    console.log('[Drive HTML] Iniciando carregamento...');
    
    import('./scripts/firebase-manager.js').then(async () => {
      console.log('[Drive HTML] Firebase Manager carregado, aguardando inicialização...');
      
      // Wait for Firebase Manager to be ready
      if (!window.firebaseManager) {
        throw new Error('Firebase Manager não foi carregado corretamente');
      }
      
      await window.firebaseManager.waitForInitialization();
      console.log('[Drive HTML] Firebase Manager inicializado, carregando Drive...');
      
      // Now load the drive script
      return import('./scripts/drive.js');
    }).then(() => {
      console.log('[Drive HTML] Sistema Drive carregado com sucesso');
    }).catch(error => {
      console.error('[Drive HTML] Erro ao carregar sistema:', error);
      document.body.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0b0f14; color: #e6eef8; font-family: Inter;">
          <div style="text-align: center; padding: 40px;">
            <h1>Erro ao Carregar Firebase Drive</h1>
            <p style="color: #9fb3c8; margin: 20px 0;">${error.message}</p>
            <button onclick="location.reload()" style="background: #1ee1a8; color: #0b0f14; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">
              Recarregar Página
            </button>
          </div>
        </div>
      `;
    });
  </script>
</body>
</html>
